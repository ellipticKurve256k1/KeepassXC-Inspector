<!doctype html>
<html lang="en" data-theme="dark">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>KeePassXC Inspector</title>
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <div class="topbar">
      <span class="brand">KeePassXC Inspector</span>
      <div class="topbar-actions">
        <button
          id="theme-toggle"
          type="button"
          class="theme-toggle"
          aria-pressed="true"
          aria-label="Switch color theme"
        >
          <span class="toggle-label">Dark</span>
          <span class="toggle-track" aria-hidden="true">
            <span class="toggle-thumb"></span>
          </span>
          <span class="toggle-label">Light</span>
        </button>
      </div>
    </div>
    <main class="page">
      <header class="hero">
        <div class="hero-heading">
          <p class="hero-kicker">KeePassXC Inspector</p>
          <h1>Unlock and verify entirely in your browser</h1>
          <p>
            Decrypt a KeePass <code>.kdbx</code> file, explore entry hashes, and review the Merkle tree without a single byte leaving
            your device.
          </p>
        </div>
        <div class="hero-metrics">
          <div>
            <span class="metric-label">100% local</span>
            <p class="metric-copy">Passwords, key files, and hashes are held in-memory only.</p>
          </div>
          <div>
            <span class="metric-label">Deterministic proofs</span>
            <p class="metric-copy">Stable Merkle roots for side-by-side database checks.</p>
          </div>
        </div>
      </header>
      <section class="panel">
        <div class="panel-heading">
          <div>
            <p class="panel-kicker">Step 1</p>
            <h2>Unlock Database</h2>
          </div>
          <p class="panel-subhead">Provide a KeePass file plus credentials and generate hashes instantly.</p>
        </div>
        <form id="unlock-form" class="form">
          <input id="kdbx-input" type="file" accept=".kdbx" required hidden />
          <label class="dropzone" id="dropzone" for="kdbx-input">
            <p>Drop a KeePass <code>.kdbx</code> file here or click to choose</p>
            <span id="selected-file" class="selected-file" hidden>No file selected</span>
          </label>
          <label class="field">
            <span>Password (optional if a key file is provided)</span>
            <div class="input-with-toggle">
              <input id="password-input" type="password" autocomplete="current-password" />
              <button id="password-visibility" type="button" class="icon-button" aria-pressed="false" aria-label="Show password">
                <span class="icon-lock" aria-hidden="true"></span>
              </button>
            </div>
          </label>
          <label class="field">
            <span>Key file (optional)</span>
            <input id="keyfile-input" type="file" />
          </label>
          <div class="form-actions">
            <button id="unlock-button" type="submit">Open database</button>
            <button id="clear-button" type="button" class="ghost">Clear</button>
          </div>
        </form>
        <p class="hint">
          The password stays in-memory only. Key files are read via the File API and never leave the browser.
        </p>
        <div id="status" class="status" role="status" aria-live="polite"></div>
      </section>
      <div id="root-banner" class="root-banner" hidden>
        <span class="root-label">Current Merkle root</span>
        <div class="root-value">
          <span id="root-prefix" class="root-prefix"></span><span id="root-suffix"></span>
        </div>
      </div>
      <section class="panel">
        <div class="panel-heading">
          <div>
            <p class="panel-kicker">Step 2</p>
            <h2>Database Preview</h2>
          </div>
          <p class="panel-subhead">Review metadata, verify hashed entries, and inspect the full Merkle structure.</p>
        </div>
        <dl class="meta" id="meta"></dl>
        <div id="data-status" class="data-status" hidden>
          <article class="status-card" id="passkey-card">
            <p class="card-kicker">Passkey coverage</p>
            <p class="card-value" id="passkey-status">—</p>
            <p class="card-footnote" id="passkey-details"></p>
          </article>
          <article class="status-card" id="attachment-card">
            <p class="card-kicker">Attachment pool</p>
            <p class="card-value" id="attachment-status">—</p>
            <p class="card-footnote" id="attachment-details"></p>
          </article>
        </div>
        <div id="recent-entries-section" class="recent-section" hidden>
          <div class="recent-heading">
            <h3>Most Recently Modified</h3>
            <p>Top five entries sorted by their last modified timestamp.</p>
          </div>
          <ol id="recent-entries-list" class="recent-list"></ol>
          <p id="recent-entries-footnote" class="footnote"></p>
        </div>
        <div id="tree-section" class="tree-section" hidden>
          <div class="tree-header">
            <div>
              <h3>Merkle Tree</h3>
              <p>Expand to audit every level of the deterministic proof.</p>
            </div>
            <button id="tree-toggle" type="button" class="ghost" disabled>Expand Merkle tree</button>
          </div>
          <div id="merkle-tree" class="merkle-tree collapsed"></div>
        </div>
      </section>
    </main>
    <div id="loading-overlay" class="loading-overlay" role="status" aria-live="polite" hidden>
      <div class="loading-content">
        <div class="loading-spinner" aria-hidden="true"></div>
        <p id="loading-message">Unlocking database…</p>
      </div>
    </div>
    <script src="./assets/argon2-bundled.min.js"></script>
    <script src="./assets/kdbxweb.js"></script>
    <script src="./app.js" type="module"></script>
  </body>
</html>
